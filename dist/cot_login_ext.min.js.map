{"version":3,"sources":["cot_login_ext.min.js"],"names":["CotSession","prototype","isLoggedIn","serverCheckCallback","_this","this","sid","_cookie","url","concat","options","indexOf","$","get","done","data","app","rsid","error","_storeLogin","LOGIN_CHECK_RESULT_TRUE","logout","LOGIN_CHECK_RESULT_FALSE","LOGIN_CHECK_RESULT_INDETERMINATE","fail","login","_this2","extend","username","password","success","always","payload","user","pwd","ajaxSettings","method","JSON","stringify","ajax","jqXHR","textStatus","cot_login","checkLogin","_this3","arguments","length","undefined","Promise","resolve","reject","result","session","requireLogin","_this4","then","showLogin","onHidden","_this5","modal","cot_app","showModal","body","className","footerButtonsHtml","originatingElement","find","title","onShown","click","_login","keydown","event","charCode","keyCode"],"mappings":"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","file":"cot_login_ext.min.js","sourcesContent":["\"use strict\";\n\n/* global cot_app cot_login CotSession */\nCotSession.prototype.isLoggedIn = function (isLoggedIn) {\n  return function (serverCheckCallback) {\n    var _this = this;\n\n    if (typeof serverCheckCallback !== 'function') {\n      return isLoggedIn();\n    }\n\n    var sid = this.sid || this._cookie('sid');\n\n    if (sid == null) {\n      serverCheckCallback(CotSession.LOGIN_CHECK_RESULT_FALSE);\n      return;\n    }\n\n    var url = \"\".concat(this.options['ccApiOrigin']).concat(this.options['ccApiPath']).concat(this.options['ccApiEndpoint']);\n\n    if (url.indexOf('/c3api_auth/v2/AuthService.svc/AuthSet') !== -1) {\n      url = \"\".concat(url, \"('\").concat(sid, \"')\");\n    } else {\n      url = \"\".concat(url, \"/\").concat(sid);\n    }\n\n    $.get(url).done(function (data) {\n      var app = data['app'] || '';\n      var rsid = data['sid'] || '';\n      var error = data['error'] || '';\n\n      if (app === _this.options['appName'] && rsid === sid) {\n        _this._storeLogin(data);\n\n        serverCheckCallback(CotSession.LOGIN_CHECK_RESULT_TRUE);\n      } else if (error === 'no_such_session') {\n        _this.logout();\n\n        serverCheckCallback(CotSession.LOGIN_CHECK_RESULT_FALSE);\n      } else {\n        serverCheckCallback(CotSession.LOGIN_CHECK_RESULT_INDETERMINATE);\n      }\n    }).fail(function () {\n      serverCheckCallback(CotSession.LOGIN_CHECK_RESULT_INDETERMINATE);\n    });\n  };\n}(CotSession.prototype.isLoggedIn);\n\nCotSession.prototype.login = function () {\n  return function (options) {\n    var _this2 = this;\n\n    options = $.extend({\n      username: '',\n      password: '',\n      success: function success() {},\n      error: function error() {},\n      always: function always() {}\n    }, options);\n    var payload = {\n      app: this.options['appName'],\n      user: options['username'],\n      pwd: options['password']\n    };\n    var ajaxSettings = {\n      method: 'POST',\n      url: \"\".concat(this.options['ccApiOrigin']).concat(this.options['ccApiPath']).concat(this.options['ccApiEndpoint'])\n    };\n\n    if (ajaxSettings['url'].indexOf('/c3api_auth/v2/AuthService.svc/AuthSet') !== -1) {\n      ajaxSettings['contentType'] = 'application/json';\n      ajaxSettings['data'] = JSON.stringify(payload);\n    } else {\n      ajaxSettings['data'] = payload;\n    }\n\n    $.ajax(ajaxSettings).done(function (data) {\n      if (data['error']) {\n        options['error'](null, data.error === 'invalid_user_or_pwd' ? 'Invalid username or password' : 'Login failed', data.error);\n      } else if (data['passwordIsExpired']) {\n        options['error'](null, 'Expired password', 'passwordIsExpired');\n      } else {\n        _this2._storeLogin(data);\n\n        options['success']();\n      }\n    }).fail(function (jqXHR, textStatus, error) {\n      options['error'](jqXHR, textStatus, error);\n    }).always(function () {\n      options['always']();\n    });\n  };\n}(CotSession.prototype.login);\n\ncot_login.prototype.checkLogin = function () {\n  var _this3 = this;\n\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (!options['serverSide']) {\n    return Promise.resolve(this.isLoggedIn());\n  }\n\n  return new Promise(function (resolve, reject) {\n    _this3.isLoggedIn(function (result) {\n      if (result === CotSession.LOGIN_CHECK_RESULT_INDETERMINATE) {\n        reject();\n      } else {\n        resolve(result === CotSession.LOGIN_CHECK_RESULT_TRUE);\n      }\n    });\n  });\n};\n\ncot_login.prototype.isLoggedIn = function (serverCheckCallback) {\n  return this.session.isLoggedIn(serverCheckCallback);\n};\n\ncot_login.prototype.requireLogin = function (options) {\n  var _this4 = this;\n\n  return this.checkLogin(options).then(function (isLoggedIn) {\n    if (isLoggedIn === false) {\n      return new Promise(function (resolve, reject) {\n        _this4.showLogin($.extend({\n          onHidden: function onHidden() {\n            _this4.checkLogin(options).then(function () {\n              resolve();\n            }, function () {\n              _this4.logout();\n\n              reject();\n            });\n          }\n        }, options));\n      });\n    }\n  });\n};\n\ncot_login.prototype.showLogin = function (options) {\n  var _this5 = this;\n\n  this.modal = cot_app.showModal($.extend({\n    body: \"\\n\\t\\t\\t<form>\\n\\t\\t\\t\\t<div class=\\\"form-group\\\">\\n\\t\\t\\t\\t\\t<label for=\\\"cot_login_username\\\">Username</label>:\\n\\t\\t\\t\\t\\t<input class=\\\"form-control\\\" id=\\\"cot_login_username\\\">\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t<div class=\\\"form-group\\\">\\n\\t\\t\\t\\t\\t<label for=\\\"cot_login_password\\\">Password</label>:\\n\\t\\t\\t\\t\\t<input class=\\\"form-control\\\" type=\\\"password\\\" id=\\\"cot_login_password\\\">\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</form>\\n\\t\\t\",\n    className: 'cot-login-modal',\n    footerButtonsHtml: \"\\n\\t\\t\\t<button class=\\\"btn btn-default btn-cot-login\\\" type=\\\"button\\\">Login</button>\\n\\t\\t\\t<button class=\\\"btn btn-default\\\" type=\\\"button\\\" data-dismiss=\\\"modal\\\">Cancel</button>\\n\\t\\t\",\n    originatingElement: $(this.options['welcomeSelector']).find('a.login'),\n    title: 'User Login',\n    onShown: function onShown() {\n      _this5.modal.find('.btn-cot-login').click(function () {\n        _this5._login();\n      });\n\n      _this5.modal.find('.modal-body input').keydown(function (event) {\n        if ((event.charCode || event.keyCode || 0) === 13) {\n          _this5._login();\n        }\n      });\n    }\n  }, options));\n};"]}